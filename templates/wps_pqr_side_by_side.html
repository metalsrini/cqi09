{% extends "base.html" %}

{% block title %}WPS/PQR Side-by-Side Comparison{% endblock %}

{% block head %}
{{ super() }}
<style>
    .document-info {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    
    .section-card {
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
    }
    
    .section-title {
        background-color: #f1f8ff;
        padding: 10px 15px;
        font-weight: bold;
        border-bottom: 1px solid #dee2e6;
    }
    
    .comparison-table th {
        background-color: #f8f9fa;
    }
    
    .parameter-label {
        font-weight: 600;
    }
    
    .parameter-value {
        font-family: 'Courier New', monospace;
        background-color: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 0.2rem;
    }
    
    .test-results-section {
        margin-top: 30px;
        border-top: 2px solid #dee2e6;
        padding-top: 20px;
    }
    
    /* Test Results Styling */
    .test-results-container {
        margin-top: 15px;
    }
    
    .test-results-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 0.9rem;
    }
    
    .test-results-table th {
        background-color: #f1f8ff;
        border: 1px solid #dee2e6;
        padding: 8px;
        text-align: left;
    }
    
    .test-results-table td {
        border: 1px solid #dee2e6;
        padding: 8px;
    }
    
    .test-results-table tr:nth-child(even) {
        background-color: #f8f9fa;
    }
    
    .reference-standards-list {
        padding-left: 20px;
    }
    
    .reference-standards-list li {
        margin-bottom: 5px;
    }
    
    .side-by-side-container {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -15px;
    }
    
    .left-side, .right-side {
        flex: 1;
        min-width: 300px;
        padding: 0 15px;
    }
    
    /* Print-friendly styles */
    @media print {
        .no-print {
            display: none;
        }
        
        .section-card {
            break-inside: avoid;
            page-break-inside: avoid;
        }
        
        body {
            font-size: 12pt;
        }
        
        .container-fluid {
            width: 100%;
            padding: 0;
        }
    }
</style>
{% endblock %}

{% block header %}
    WPS/PQR Side-by-Side Comparison
{% endblock %}

{% block content %}
<div class="container-fluid my-4">
    <nav aria-label="breadcrumb" class="no-print">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('wps_pqr_comparison_upload') }}">WPS/PQR Comparison</a></li>
            <li class="breadcrumb-item active" aria-current="page">Side-by-Side Comparison</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-3 no-print">
        <h2>WPS/PQR Document Comparison</h2>
        <div>
            <button class="btn btn-outline-primary me-2" onclick="window.print()">
                <i class="fas fa-print"></i> Print
            </button>
        </div>
    </div>

    <!-- Document Information -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Document Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="document-info">
                        <h5>WPS Information</h5>
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <th style="width: 40%">WPS Number:</th>
                                    <td>{{ wps_data.document_info.get('wps_number', wps_data.document_info.get('number', wps_data.document_info.get('document_number', 'Not specified'))) }}</td>
                                </tr>
                                <tr>
                                    <th>Revision:</th>
                                    <td>{{ wps_data.document_info.get('revision', wps_data.document_info.get('rev', wps_data.document_info.get('revision_number', 'Not specified'))) }}</td>
                                </tr>
                                <tr>
                                    <th>Date:</th>
                                    <td>{{ wps_data.document_info.get('date', 'Not specified') }}</td>
                                </tr>
                                <tr>
                                    <th>Company:</th>
                                    <td>{{ wps_data.document_info.get('company', wps_data.document_info.get('manufacturer', 'Not specified')) }}</td>
                                </tr>
                                <tr>
                                    <th>Welding Process(es):</th>
                                    <td>
                                        {% if wps_data.document_info.welding_process is defined %}
                                            {% if wps_data.document_info.welding_process is mapping and wps_data.document_info.welding_process.processes is defined %}
                                                {% if wps_data.document_info.welding_process.processes is iterable and not wps_data.document_info.welding_process.processes is string %}
                                                    {{ wps_data.document_info.welding_process.processes|join(', ') }}
                                                {% else %}
                                                    {{ wps_data.document_info.welding_process.processes }}
                                                {% endif %}
                                            {% elif wps_data.document_info.welding_process is string %}
                                                {{ wps_data.document_info.welding_process }}
                                            {% elif wps_data.document_info.welding_process is iterable and not wps_data.document_info.welding_process is string %}
                                                {{ wps_data.document_info.welding_process|join(', ') }}
                                            {% else %}
                                                Not specified
                                            {% endif %}
                                        {% elif wps_data.document_info.get('processes') is defined %}
                                            {% if wps_data.document_info.processes is iterable and not wps_data.document_info.processes is string %}
                                                {{ wps_data.document_info.processes|join(', ') }}
                                            {% else %}
                                                {{ wps_data.document_info.processes }}
                                            {% endif %}
                                        {% elif wps_data.document_info.get('process') is defined %}
                                            {{ wps_data.document_info.process }}
                                        {% else %}
                                            Not specified
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>PQR Reference No.:</th>
                                    <td>{{ wps_data.document_info.get('pqr_reference', wps_data.document_info.get('pqr_references', 'Not specified')) }}</td>
                                </tr>
                                {% for key, value in wps_data.document_info.items() %}
                                    {% if key not in ['wps_number', 'number', 'revision', 'date', 'company', 'manufacturer', 'welding_process', 'processes', 'process', 'pqr_reference', 'pqr_references'] %}
                                        <tr>
                                            <th>{{ key|replace('_', ' ')|title }}:</th>
                                            <td>
                                                {% if value is mapping %}
                                                    <table class="table table-sm mb-0">
                                                        {% for subkey, subvalue in value.items() %}
                                                            <tr>
                                                                <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                <td>{{ subvalue }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% elif value is iterable and not value is string %}
                                                    {{ value|join(', ') }}
                                                {% else %}
                                                    {{ value }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="document-info">
                        <h5>PQR Information</h5>
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <th style="width: 40%">PQR Number:</th>
                                    <td>{{ pqr_data.document_info.get('pqr_number', pqr_data.document_info.get('number', 'Not specified')) }}</td>
                                </tr>
                                <tr>
                                    <th>Revision:</th>
                                    <td>{{ pqr_data.document_info.get('revision', 'Not specified') }}</td>
                                </tr>
                                <tr>
                                    <th>Date:</th>
                                    <td>{{ pqr_data.document_info.get('date', 'Not specified') }}</td>
                                </tr>
                                <tr>
                                    <th>Company:</th>
                                    <td>{{ pqr_data.document_info.get('company', pqr_data.document_info.get('manufacturer', 'Not specified')) }}</td>
                                </tr>
                                <tr>
                                    <th>Welding Process(es):</th>
                                    <td>
                                        {% if pqr_data.document_info.welding_process is defined %}
                                            {% if pqr_data.document_info.welding_process is mapping and pqr_data.document_info.welding_process.processes is defined %}
                                                {% if pqr_data.document_info.welding_process.processes is iterable and not pqr_data.document_info.welding_process.processes is string %}
                                                    {{ pqr_data.document_info.welding_process.processes|join(', ') }}
                                                {% else %}
                                                    {{ pqr_data.document_info.welding_process.processes }}
                                                {% endif %}
                                            {% elif pqr_data.document_info.welding_process is string %}
                                                {{ pqr_data.document_info.welding_process }}
                                            {% elif pqr_data.document_info.welding_process is iterable and not pqr_data.document_info.welding_process is string %}
                                                {{ pqr_data.document_info.welding_process|join(', ') }}
                                            {% else %}
                                                Not specified
                                            {% endif %}
                                        {% elif pqr_data.document_info.get('processes') is defined %}
                                            {% if pqr_data.document_info.processes is iterable and not pqr_data.document_info.processes is string %}
                                                {{ pqr_data.document_info.processes|join(', ') }}
                                            {% else %}
                                                {{ pqr_data.document_info.processes }}
                                            {% endif %}
                                        {% elif pqr_data.document_info.get('process') is defined %}
                                            {{ pqr_data.document_info.process }}
                                        {% else %}
                                            Not specified
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>WPS No.:</th>
                                    <td>{{ pqr_data.document_info.get('wps_no', pqr_data.document_info.get('wps_reference', pqr_data.document_info.get('wps_number', 'Not specified'))) }}</td>
                                </tr>
                                {% for key, value in pqr_data.document_info.items() %}
                                    {% if key not in ['pqr_number', 'number', 'revision', 'date', 'company', 'manufacturer', 'welding_process', 'processes', 'process', 'wps_no', 'wps_reference', 'wps_number'] %}
                                        <tr>
                                            <th>{{ key|replace('_', ' ')|title }}:</th>
                                            <td>
                                                {% if value is mapping %}
                                                    <table class="table table-sm mb-0">
                                                        {% for subkey, subvalue in value.items() %}
                                                            <tr>
                                                                <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                <td>{{ subvalue }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% elif value is iterable and not value is string %}
                                                    {{ value|join(', ') }}
                                                {% else %}
                                                    {{ value }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-402: JOINTS -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-402: JOINTS</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.joints is defined and wps_data.joints %}
                                {% set joints_data = wps_data.joints %}
                            {% elif wps_data.joint is defined and wps_data.joint %}
                                {% set joints_data = wps_data.joint %}
                            {% else %}
                                {% set joints_data = None %}
                            {% endif %}

                            {% if joints_data is mapping %}
                                {% for key, value in joints_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif joints_data is string %}
                                <tr>
                                    <td colspan="2">{{ joints_data }}</td>
                                </tr>
                            {% elif joints_data is iterable and not joints_data is string and joints_data %}
                                {% for item in joints_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No joint details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.joints is defined and pqr_data.joints %}
                                {% set joints_data = pqr_data.joints %}
                            {% elif pqr_data.joint is defined and pqr_data.joint %}
                                {% set joints_data = pqr_data.joint %}
                            {% else %}
                                {% set joints_data = None %}
                            {% endif %}
                            
                            {% if joints_data is mapping %}
                                {% for key, value in joints_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif joints_data is string %}
                                <tr>
                                    <td colspan="2">{{ joints_data }}</td>
                                </tr>
                            {% elif joints_data is iterable and not joints_data is string and joints_data %}
                                {% for item in joints_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No joint details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-403: BASE METALS -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-403: BASE METALS</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.base_metals is defined %}
                                {% set metals_data = wps_data.base_metals %}
                            {% elif wps_data.base_metal is defined %}
                                {% set metals_data = wps_data.base_metal %}
                            {% elif wps_data.metals is defined %}
                                {% set metals_data = wps_data.metals %}
                            {% else %}
                                {% set metals_data = None %}
                            {% endif %}

                            {% if metals_data is mapping %}
                                {% for key, value in metals_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>
                                                                {% if 'thickness' in subkey|lower %}
                                                                    {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                                {% elif 'diameter' in subkey|lower %}
                                                                    {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                                {% else %}
                                                                    {{ subvalue|default('N/A', true) }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% elif 'thickness' in key|lower %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                            {% elif 'diameter' in key|lower %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif metals_data is string %}
                                <tr>
                                    <td colspan="2">{{ metals_data }}</td>
                                </tr>
                            {% elif metals_data is iterable and not metals_data is string and metals_data %}
                                {% for item in metals_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>
                                                    {% if 'thickness' in key|lower %}
                                                        {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                    {% elif 'diameter' in key|lower %}
                                                        {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                    {% else %}
                                                        {{ value|default('N/A', true) }}
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No base metal details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.base_metals is defined %}
                                {% set metals_data = pqr_data.base_metals %}
                            {% elif pqr_data.base_metal is defined %}
                                {% set metals_data = pqr_data.base_metal %}
                            {% elif pqr_data.metals is defined %}
                                {% set metals_data = pqr_data.metals %}
                            {% else %}
                                {% set metals_data = None %}
                            {% endif %}
                            
                            {% if metals_data is mapping %}
                                {% for key, value in metals_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>
                                                                {% if 'thickness' in subkey|lower %}
                                                                    {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                                {% elif 'diameter' in subkey|lower %}
                                                                    {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                                {% else %}
                                                                    {{ subvalue|default('N/A', true) }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% elif 'thickness' in key|lower %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                            {% elif 'diameter' in key|lower %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif metals_data is string %}
                                <tr>
                                    <td colspan="2">{{ metals_data }}</td>
                                </tr>
                            {% elif metals_data is iterable and not metals_data is string and metals_data %}
                                {% for item in metals_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>
                                                    {% if 'thickness' in key|lower %}
                                                        {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                    {% elif 'diameter' in key|lower %}
                                                        {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                    {% else %}
                                                        {{ value|default('N/A', true) }}
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No base metal details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-404: FILLER METALS -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-404: FILLER METALS</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.filler_metals is defined %}
                                {% set filler_data = wps_data.filler_metals %}
                            {% elif wps_data.filler_metal is defined %}
                                {% set filler_data = wps_data.filler_metal %}
                            {% elif wps_data.fillers is defined %}
                                {% set filler_data = wps_data.fillers %}
                            {% else %}
                                {% set filler_data = None %}
                            {% endif %}

                            {% if filler_data is mapping %}
                                {% set processes_key = "" %}
                                {% for key, value in filler_data.items() %}
                                    {% if key in ["processes", "process_specific"] %}
                                        {% set processes_key = key %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if processes_key %}
                                    <!-- Handle the case where processes is a key with nested dictionaries -->
                                    {% for process, details in filler_data[processes_key].items() %}
                                        <tr>
                                            <th colspan="2" class="bg-light">Process: {{ process }}</th>
                                        </tr>
                                        {% if details is mapping %}
                                            {% for key, value in details.items() %}
                                                <tr>
                                                    <th>{{ key|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if key in ['f_number', 'f-number'] %}
                                                            F-{{ value|default('N/A', true) }}
                                                        {% elif key in ['a_number', 'a-number'] %}
                                                            A-{{ value|default('N/A', true) }}
                                                        {% elif 'size' in key|lower and value %}
                                                            {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ value|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="2">{{ details }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <!-- Standard process-based handling -->
                                    {% for key, value in filler_data.items() %}
                                        <tr>
                                            <th colspan="2" class="bg-light">{{ key|replace('_', ' ')|title }}</th>
                                        </tr>
                                        {% if value is mapping %}
                                            {% for subkey, subvalue in value.items() %}
                                                <tr>
                                                    <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if subvalue is mapping %}
                                                            <table class="table table-sm mb-0">
                                                                {% for subsubkey, subsubvalue in subvalue.items() %}
                                                                <tr>
                                                                    <th>{{ subsubkey|replace('_', ' ')|title }}</th>
                                                                    <td>
                                                                        {% if subsubkey in ['f_number', 'f-number'] %}
                                                                            F-{{ subsubvalue|default('N/A', true) }}
                                                                        {% elif subsubkey in ['a_number', 'a-number'] %}
                                                                            A-{{ subsubvalue|default('N/A', true) }}
                                                                        {% elif 'size' in subsubkey|lower and subsubvalue %}
                                                                            {{ subsubvalue|default('N/A', true) }}{% if subsubvalue and subsubvalue is not string and not 'mm' in subsubvalue|string and not 'in' in subsubvalue|string %} mm{% endif %}
                                                                        {% else %}
                                                                            {{ subsubvalue|default('N/A', true) }}
                                                                        {% endif %}
                                                                    </td>
                                                                </tr>
                                                                {% endfor %}
                                                            </table>
                                                        {% elif subkey in ['f_number', 'f-number'] %}
                                                            F-{{ subvalue|default('N/A', true) }}
                                                        {% elif subkey in ['a_number', 'a-number'] %}
                                                            A-{{ subvalue|default('N/A', true) }}
                                                        {% elif 'size' in subkey|lower and subvalue %}
                                                            {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ subvalue|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="2">{{ value }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% elif filler_data is iterable and not filler_data is string %}
                                <!-- Handle array-based filler_metals structure -->
                                {% for item in filler_data %}
                                    {% if item is mapping %}
                                        <tr>
                                            <th colspan="2" class="bg-light">Process: {{ item.process|default('Not specified', true) }}</th>
                                        </tr>
                                        {% for key, value in item.items() %}
                                            {% if key != 'process' %}
                                                <tr>
                                                    <th>{{ key|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if key in ['f_number', 'f-number'] %}
                                                            F-{{ value|default('N/A', true) }}
                                                        {% elif key in ['a_number', 'a-number'] %}
                                                            A-{{ value|default('N/A', true) }}
                                                        {% elif 'size' in key|lower and value %}
                                                            {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ value|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% elif filler_data is string %}
                                <tr>
                                    <td colspan="2">{{ filler_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No filler metal details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.filler_metals is defined %}
                                {% set filler_data = pqr_data.filler_metals %}
                            {% elif pqr_data.filler_metal is defined %}
                                {% set filler_data = pqr_data.filler_metal %}
                            {% elif pqr_data.fillers is defined %}
                                {% set filler_data = pqr_data.fillers %}
                            {% else %}
                                {% set filler_data = None %}
                            {% endif %}
                            
                            {% if filler_data is mapping %}
                                {% set processes_key = "" %}
                                {% for key, value in filler_data.items() %}
                                    {% if key in ["processes", "process_specific"] %}
                                        {% set processes_key = key %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if processes_key %}
                                    <!-- Handle the case where processes/process_specific is a key with nested dictionaries -->
                                    {% for process, details in filler_data[processes_key].items() %}
                                        <tr>
                                            <th colspan="2" class="bg-light">Process: {{ process }}</th>
                                        </tr>
                                        {% if details is mapping %}
                                            {% for key, value in details.items() %}
                                                <tr>
                                                    <th>{{ key|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if key in ['f_number', 'f-number'] %}
                                                            F-{{ value|default('N/A', true) }}
                                                        {% elif key in ['a_number', 'a-number'] %}
                                                            A-{{ value|default('N/A', true) }}
                                                        {% elif 'size' in key|lower and value %}
                                                            {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ value|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="2">{{ details }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <!-- Standard process-based handling -->
                                    {% for key, value in filler_data.items() %}
                                        <tr>
                                            <th colspan="2" class="bg-light">{{ key|replace('_', ' ')|title }}</th>
                                        </tr>
                                        {% if value is mapping %}
                                            {% for subkey, subvalue in value.items() %}
                                                <tr>
                                                    <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if subvalue is mapping %}
                                                            <table class="table table-sm mb-0">
                                                                {% for subsubkey, subsubvalue in subvalue.items() %}
                                                                <tr>
                                                                    <th>{{ subsubkey|replace('_', ' ')|title }}</th>
                                                                    <td>
                                                                        {% if subsubkey in ['f_number', 'f-number'] %}
                                                                            F-{{ subsubvalue|default('N/A', true) }}
                                                                        {% elif subsubkey in ['a_number', 'a-number'] %}
                                                                            A-{{ subsubvalue|default('N/A', true) }}
                                                                        {% elif 'size' in subsubkey|lower and subsubvalue %}
                                                                            {{ subsubvalue|default('N/A', true) }}{% if subsubvalue and subsubvalue is not string and not 'mm' in subsubvalue|string and not 'in' in subsubvalue|string %} mm{% endif %}
                                                                        {% else %}
                                                                            {{ subsubvalue|default('N/A', true) }}
                                                                        {% endif %}
                                                                    </td>
                                                                </tr>
                                                                {% endfor %}
                                                            </table>
                                                        {% elif subkey in ['f_number', 'f-number'] %}
                                                            F-{{ subvalue|default('N/A', true) }}
                                                        {% elif subkey in ['a_number', 'a-number'] %}
                                                            A-{{ subvalue|default('N/A', true) }}
                                                        {% elif 'size' in subkey|lower and subvalue %}
                                                            {{ subvalue|default('N/A', true) }}{% if subvalue and subvalue is not string and not 'mm' in subvalue|string and not 'in' in subvalue|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ subvalue|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="2">{{ value }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% elif filler_data is iterable and not filler_data is string %}
                                <!-- Handle array-based filler_metals structure -->
                                {% for item in filler_data %}
                                    {% if item is mapping %}
                                        <tr>
                                            <th colspan="2" class="bg-light">Process: {{ item.process|default('Not specified', true) }}</th>
                                        </tr>
                                        {% for key, value in item.items() %}
                                            {% if key != 'process' %}
                                                <tr>
                                                    <th>{{ key|replace('_', ' ')|title }}</th>
                                                    <td>
                                                        {% if key in ['f_number', 'f-number'] %}
                                                            F-{{ value|default('N/A', true) }}
                                                        {% elif key in ['a_number', 'a-number'] %}
                                                            A-{{ value|default('N/A', true) }}
                                                        {% elif 'size' in key|lower and value %}
                                                            {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm' in value|string and not 'in' in value|string %} mm{% endif %}
                                                        {% else %}
                                                            {{ value|default('N/A', true) }}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% elif filler_data is string %}
                                <tr>
                                    <td colspan="2">{{ filler_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No filler metal details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-405: POSITION -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-405: POSITION</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.position is mapping %}
                                {% for key, value in wps_data.position.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif wps_data.position is iterable and not wps_data.position is string %}
                                <!-- Handle array-based position structure -->
                                {% for item in wps_data.position %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% elif wps_data.position is string %}
                                <tr>
                                    <td colspan="2">{{ wps_data.position }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No position details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.position is mapping %}
                                {% for key, value in pqr_data.position.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif pqr_data.position is iterable and not pqr_data.position is string %}
                                <!-- Handle array-based position structure -->
                                {% for item in pqr_data.position %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% elif pqr_data.position is string %}
                                <tr>
                                    <td colspan="2">{{ pqr_data.position }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No position details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-406: PREHEAT -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-406: PREHEAT</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.preheat is defined %}
                                {% set preheat_data = wps_data.preheat %}
                            {% elif wps_data.preheating is defined %}
                                {% set preheat_data = wps_data.preheating %}
                            {% else %}
                                {% set preheat_data = None %}
                            {% endif %}

                            {% if preheat_data is mapping %}
                                {% for key, value in preheat_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if 'temp' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C' in value|string and not 'F' in value|string and not 'C' in value|string and not 'F' in value|string %} C{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif preheat_data is string %}
                                <tr>
                                    <td colspan="2">{{ preheat_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No preheat details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.preheat is defined %}
                                {% set preheat_data = pqr_data.preheat %}
                            {% elif pqr_data.preheating is defined %}
                                {% set preheat_data = pqr_data.preheating %}
                            {% else %}
                                {% set preheat_data = None %}
                            {% endif %}
                            
                            {% if preheat_data is mapping %}
                                {% for key, value in preheat_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if 'temp' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C' in value|string and not 'F' in value|string and not 'C' in value|string and not 'F' in value|string %} C{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif preheat_data is string %}
                                <tr>
                                    <td colspan="2">{{ preheat_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No preheat details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-407: POST WELD HEAT TREATMENT -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-407: POST WELD HEAT TREATMENT</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.pwht is defined %}
                                {% set pwht_data = wps_data.pwht %}
                            {% elif wps_data.post_weld_heat_treatment is defined %}
                                {% set pwht_data = wps_data.post_weld_heat_treatment %}
                            {% else %}
                                {% set pwht_data = None %}
                            {% endif %}

                            {% if pwht_data is mapping %}
                                {% for key, value in pwht_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if 'temp' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C' in value|string and not 'F' in value|string and not 'C' in value|string and not 'F' in value|string %} C{% endif %}
                                            {% elif 'time' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'hr' in value|string and not 'min' in value|string %} hr{% endif %}
                                            {% elif 'rate' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C/hr' in value|string and not 'F/hr' in value|string %} C/hr{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif pwht_data is string %}
                                <tr>
                                    <td colspan="2">{{ pwht_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No PWHT details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.pwht is defined %}
                                {% set pwht_data = pqr_data.pwht %}
                            {% elif pqr_data.post_weld_heat_treatment is defined %}
                                {% set pwht_data = pqr_data.post_weld_heat_treatment %}
                            {% else %}
                                {% set pwht_data = None %}
                            {% endif %}
                            
                            {% if pwht_data is mapping %}
                                {% for key, value in pwht_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if 'temp' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C' in value|string and not 'F' in value|string and not 'C' in value|string and not 'F' in value|string %} C{% endif %}
                                            {% elif 'time' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'hr' in value|string and not 'min' in value|string %} hr{% endif %}
                                            {% elif 'rate' in key|lower and value %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'C/hr' in value|string and not 'F/hr' in value|string %} C/hr{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif pwht_data is string %}
                                <tr>
                                    <td colspan="2">{{ pwht_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No PWHT details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-408: GAS -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-408: GAS</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.gas is mapping %}
                                {% for key, value in wps_data.gas.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for prop_key, prop_value in value.items() %}
                                                        <tr>
                                                            <th style="width: 40%">{{ prop_key|replace('_', ' ')|title }}</th>
                                                            <td>{{ prop_value|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif wps_data.gas is string %}
                                <tr>
                                    <td colspan="2">{{ wps_data.gas }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No gas details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.gas is mapping %}
                                {% for key, value in pqr_data.gas.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for prop_key, prop_value in value.items() %}
                                                        <tr>
                                                            <th style="width: 40%">{{ prop_key|replace('_', ' ')|title }}</th>
                                                            <td>{{ prop_value|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif pqr_data.gas is string %}
                                <tr>
                                    <td colspan="2">{{ pqr_data.gas }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No gas details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-409: ELECTRICAL CHARACTERISTICS -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-409: ELECTRICAL CHARACTERISTICS</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.electrical_characteristics is defined %}
                                {% set elec_data = wps_data.electrical_characteristics %}
                            {% elif wps_data.electrical is defined %}
                                {% set elec_data = wps_data.electrical %}
                            {% else %}
                                {% set elec_data = None %}
                            {% endif %}

                            {% if elec_data is mapping %}
                                {% for key, value in elec_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for process, polarity in value.items() %}
                                                        <tr>
                                                            <th>{{ process }}</th>
                                                            <td>{{ polarity|default('N/A', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif key|lower in ['amperage', 'ampere', 'amps', 'current'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'A' in value|string %} A{% endif %}
                                            {% elif key|lower in ['voltage', 'volts'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'V' in value|string %} V{% endif %}
                                            {% elif key|lower in ['wire_feed_speed', 'wire_feed'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm/min' in value|string and not 'in/min' in value|string %} mm/min{% endif %}
                                            {% elif key|lower in ['travel_speed'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm/min' in value|string and not 'in/min' in value|string %} mm/min{% endif %}
                                            {% elif key|lower in ['heat_input'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'kJ/mm' in value|string and not 'kJ/in' in value|string %} kJ/mm{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif elec_data is string %}
                                <tr>
                                    <td colspan="2">{{ elec_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No electrical characteristics specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.electrical_characteristics is defined %}
                                {% set elec_data = pqr_data.electrical_characteristics %}
                            {% elif pqr_data.electrical is defined %}
                                {% set elec_data = pqr_data.electrical %}
                            {% else %}
                                {% set elec_data = None %}
                            {% endif %}

                            {% if elec_data is mapping %}
                                {% for key, value in elec_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm table-borderless mb-0">
                                                    {% for process, polarity in value.items() %}
                                                        <tr>
                                                            <th>{{ process }}</th>
                                                            <td>{{ polarity|default('N/A', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif key|lower in ['amperage', 'ampere', 'amps', 'current'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'A' in value|string %} A{% endif %}
                                            {% elif key|lower in ['voltage', 'volts'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'V' in value|string %} V{% endif %}
                                            {% elif key|lower in ['wire_feed_speed', 'wire_feed'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm/min' in value|string and not 'in/min' in value|string %} mm/min{% endif %}
                                            {% elif key|lower in ['travel_speed'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'mm/min' in value|string and not 'in/min' in value|string %} mm/min{% endif %}
                                            {% elif key|lower in ['heat_input'] %}
                                                {{ value|default('N/A', true) }}{% if value and value is not string and not 'kJ/mm' in value|string and not 'kJ/in' in value|string %} kJ/mm{% endif %}
                                            {% else %}
                                                {{ value|default('N/A', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif elec_data is string %}
                                <tr>
                                    <td colspan="2">{{ elec_data }}</td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="2">No electrical characteristics specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QW-410: TECHNIQUE -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">QW-410: TECHNIQUE</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if wps_data.technique is defined %}
                                {% set technique_data = wps_data.technique %}
                            {% elif wps_data.techniques is defined %}
                                {% set technique_data = wps_data.techniques %}
                            {% elif wps_data.welding_technique is defined %}
                                {% set technique_data = wps_data.welding_technique %}
                            {% else %}
                                {% set technique_data = None %}
                            {% endif %}

                            {% if technique_data is mapping %}
                                {% for key, value in technique_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif technique_data is string %}
                                <tr>
                                    <td colspan="2">{{ technique_data }}</td>
                                </tr>
                            {% elif technique_data is iterable and not technique_data is string and technique_data %}
                                {% for item in technique_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No technique details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            {% if pqr_data.technique is defined %}
                                {% set technique_data = pqr_data.technique %}
                            {% elif pqr_data.techniques is defined %}
                                {% set technique_data = pqr_data.techniques %}
                            {% elif pqr_data.welding_technique is defined %}
                                {% set technique_data = pqr_data.welding_technique %}
                            {% else %}
                                {% set technique_data = None %}
                            {% endif %}
                            
                            {% if technique_data is mapping %}
                                {% for key, value in technique_data.items() %}
                                    <tr>
                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                        <td>
                                            {% if value is mapping %}
                                                <table class="table table-sm mb-0">
                                                    {% for subkey, subvalue in value.items() %}
                                                        <tr>
                                                            <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                            <td>{{ subvalue|default('Not specified', true) }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            {% elif value is iterable and not value is string %}
                                                {{ value|join(', ') }}
                                            {% else %}
                                                {{ value|default('Not specified', true) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% elif technique_data is string %}
                                <tr>
                                    <td colspan="2">{{ technique_data }}</td>
                                </tr>
                            {% elif technique_data is iterable and not technique_data is string and technique_data %}
                                {% for item in technique_data %}
                                    {% if item is mapping %}
                                        {% for key, value in item.items() %}
                                            <tr>
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                                <td>{{ value|default('Not specified', true) }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="2">{{ item }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="2">No technique details specified</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Welding Parameter Table -->
    <div class="card section-card">
        <div class="card-header">
            <h5 class="mb-0 section-title">Welding Parameters Table</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>WPS</h6>
                    {% if wps_data.welding_parameter_table is defined %}
                        {% set params_data = wps_data.welding_parameter_table %}
                    {% elif wps_data.welding_parameters is defined %}
                        {% set params_data = wps_data.welding_parameters %}
                    {% elif wps_data.parameter_table is defined %}
                        {% set params_data = wps_data.parameter_table %}
                    {% else %}
                        {% set params_data = None %}
                    {% endif %}

                    {% if params_data and params_data|length > 0 and params_data is iterable and not params_data is string %}
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        {% if params_data[0] is mapping %}
                                            {% for key in params_data[0].keys() %}
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                            {% endfor %}
                                        {% elif 'process' in params_data|string|lower %}
                                            <th>Process</th>
                                            <th>Pass Number</th>
                                            <th>Filler Metal</th>
                                            <th>Current</th>
                                            <th>Amperage</th>
                                            <th>Voltage</th>
                                            <th>Travel Speed</th>
                                            <th>Heat Input</th>
                                        {% else %}
                                            <th>Value</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in params_data %}
                                        <tr>
                                            {% if row is mapping %}
                                                {% for value in row.values() %}
                                                    <td>{{ value|default('', true) }}</td>
                                                {% endfor %}
                                            {% elif 'process' in params_data|string|lower and row is string %}
                                                {% set parts = row.split('|') %}
                                                {% if parts|length >= 8 %}
                                                    {% for part in parts %}
                                                        <td>{{ part|trim }}</td>
                                                    {% endfor %}
                                                {% else %}
                                                    <td colspan="8">{{ row }}</td>
                                                {% endif %}
                                            {% else %}
                                                <td>{{ row }}</td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif params_data is mapping %}
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <tbody>
                                    {% for key, value in params_data.items() %}
                                        <tr>
                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                            <td>
                                                {% if value is mapping %}
                                                    <table class="table table-sm table-borderless mb-0">
                                                        {% for subkey, subvalue in value.items() %}
                                                            <tr>
                                                                <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                <td>{{ subvalue|default('Not specified', true) }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% elif value is iterable and not value is string %}
                                                    <table class="table table-sm table-borderless mb-0">
                                                        {% if value|length > 0 and value[0] is mapping %}
                                                            <thead>
                                                                <tr>
                                                                    {% for subkey in value[0].keys() %}
                                                                        <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                    {% endfor %}
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for item in value %}
                                                                    <tr>
                                                                        {% for subvalue in item.values() %}
                                                                            <td>{{ subvalue|default('', true) }}</td>
                                                                        {% endfor %}
                                                                    </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        {% else %}
                                                            <tr>
                                                                <td>
                                                                    <ul class="mb-0">
                                                                        {% for item in value %}
                                                                            <li>{{ item }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </td>
                                                            </tr>
                                                        {% endif %}
                                                    </table>
                                                {% else %}
                                                    {{ value|default('Not specified', true) }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif params_data is string %}
                        <p>{{ params_data }}</p>
                    {% else %}
                        <p>No welding parameter table specified</p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <h6>PQR</h6>
                    {% if pqr_data.welding_parameter_table is defined %}
                        {% set params_data = pqr_data.welding_parameter_table %}
                    {% elif pqr_data.welding_parameters is defined %}
                        {% set params_data = pqr_data.welding_parameters %}
                    {% elif pqr_data.parameter_table is defined %}
                        {% set params_data = pqr_data.parameter_table %}
                    {% else %}
                        {% set params_data = None %}
                    {% endif %}

                    {% if params_data and params_data|length > 0 and params_data is iterable and not params_data is string %}
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        {% if params_data[0] is mapping %}
                                            {% for key in params_data[0].keys() %}
                                                <th>{{ key|replace('_', ' ')|title }}</th>
                                            {% endfor %}
                                        {% elif 'process' in params_data|string|lower %}
                                            <th>Process</th>
                                            <th>Pass Number</th>
                                            <th>Filler Metal</th>
                                            <th>Current</th>
                                            <th>Amperage</th>
                                            <th>Voltage</th>
                                            <th>Travel Speed</th>
                                            <th>Heat Input</th>
                                        {% else %}
                                            <th>Value</th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in params_data %}
                                        <tr>
                                            {% if row is mapping %}
                                                {% for value in row.values() %}
                                                    <td>{{ value|default('', true) }}</td>
                                                {% endfor %}
                                            {% elif 'process' in params_data|string|lower and row is string %}
                                                {% set parts = row.split('|') %}
                                                {% if parts|length >= 8 %}
                                                    {% for part in parts %}
                                                        <td>{{ part|trim }}</td>
                                                    {% endfor %}
                                                {% else %}
                                                    <td colspan="8">{{ row }}</td>
                                                {% endif %}
                                            {% else %}
                                                <td>{{ row }}</td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif params_data is mapping %}
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <tbody>
                                    {% for key, value in params_data.items() %}
                                        <tr>
                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                            <td>
                                                {% if value is mapping %}
                                                    <table class="table table-sm table-borderless mb-0">
                                                        {% for subkey, subvalue in value.items() %}
                                                            <tr>
                                                                <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                <td>{{ subvalue|default('Not specified', true) }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                {% elif value is iterable and not value is string %}
                                                    <table class="table table-sm table-borderless mb-0">
                                                        {% if value|length > 0 and value[0] is mapping %}
                                                            <thead>
                                                                <tr>
                                                                    {% for subkey in value[0].keys() %}
                                                                        <th>{{ subkey|replace('_', ' ')|title }}</th>
                                                                    {% endfor %}
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for item in value %}
                                                                    <tr>
                                                                        {% for subvalue in item.values() %}
                                                                            <td>{{ subvalue|default('', true) }}</td>
                                                                        {% endfor %}
                                                                    </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        {% else %}
                                                            <tr>
                                                                <td>
                                                                    <ul class="mb-0">
                                                                        {% for item in value %}
                                                                            <li>{{ item }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </td>
                                                            </tr>
                                                        {% endif %}
                                                    </table>
                                                {% else %}
                                                    {{ value|default('Not specified', true) }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif params_data is string %}
                        <p>{{ params_data }}</p>
                    {% else %}
                        <p>No welding parameter table specified</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Test Results Section -->
    <div class="section">
        <h2>Test Results Overview</h2>
        <div class="container-fluid px-0">
            <div class="row">
                <div class="col-12">
                    <h3>PQR Test Results</h3>
                    {% if pqr_data.test_results is defined and pqr_data.test_results %}
                        <div class="test-results-container">
                            {% if pqr_data.test_results is mapping %}
                                <!-- Tensile Test Section -->
                                {% set tensile_test = pqr_data.test_results.get('tensile_test', {}) %}
                                {% if tensile_test %}
                                    <h4>Tensile Test</h4>
                                    {% if tensile_test is mapping and tensile_test.specimens is defined and tensile_test.specimens|length > 0 %}
                                        <table class="test-results-table">
                                            <thead>
                                                <tr>
                                                    <th>Specimen</th>
                                                    <th>Location</th>
                                                    <th>Width</th>
                                                    <th>Thickness</th>
                                                    <th>Area</th>
                                                    <th>Ultimate Load</th>
                                                    <th>Ultimate Strength</th>
                                                    <th>Failure Location</th>
                                                    <th>Result</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for specimen in tensile_test.specimens %}
                                                    {% if specimen is mapping %}
                                                        <tr>
                                                            <td>{{ specimen.get('specimen_number', specimen.get('specimen_id', loop.index)) }}</td>
                                                            <td>{{ specimen.get('location', 'N/A') }}</td>
                                                            <td>{{ specimen.get('width', 'N/A') }}</td>
                                                            <td>{{ specimen.get('thickness', 'N/A') }}</td>
                                                            <td>{{ specimen.get('area', 'N/A') }}</td>
                                                            <td>{{ specimen.get('ultimate_load', 'N/A') }}</td>
                                                            <td>{{ specimen.get('ultimate_strength', specimen.get('ultimate_stress', 'N/A')) }}</td>
                                                            <td>{{ specimen.get('failure_location', 'N/A') }}</td>
                                                            <td>{{ specimen.get('result', 'N/A') }}</td>
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td colspan="9">{{ specimen }}</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% elif tensile_test is string %}
                                        <p>{{ tensile_test }}</p>
                                    {% else %}
                                        <p>Tensile test information available but in non-standard format</p>
                                        <pre>{{ tensile_test|string }}</pre>
                                    {% endif %}
                                {% endif %}

                                <!-- Guided Bend Test Section -->
                                {% set guided_bend_test = pqr_data.test_results.get('guided_bend_test', {}) %}
                                {% if guided_bend_test %}
                                    <h4>Guided Bend Test</h4>
                                    {% if guided_bend_test is mapping and guided_bend_test.specimens is defined and guided_bend_test.specimens|length > 0 %}
                                        <table class="test-results-table">
                                            <thead>
                                                <tr>
                                                    <th>Specimen</th>
                                                    <th>Type</th>
                                                    <th>Result</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for specimen in guided_bend_test.specimens %}
                                                    {% if specimen is mapping %}
                                                        <tr>
                                                            <td>{{ specimen.get('specimen_number', specimen.get('specimen_id', loop.index)) }}</td>
                                                            <td>{{ specimen.get('type', 'N/A') }}</td>
                                                            <td>{{ specimen.get('result', 'N/A') }}</td>
                                                        </tr>
                                                    {% else %}
                                                        <tr>
                                                            <td colspan="3">{{ specimen }}</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% elif guided_bend_test is string %}
                                        <p>{{ guided_bend_test }}</p>
                                    {% else %}
                                        <p>Guided bend test information available but in non-standard format</p>
                                        <pre>{{ guided_bend_test|string }}</pre>
                                    {% endif %}
                                {% endif %}

                                <!-- Impact Test Section -->
                                {% set impact_test = pqr_data.test_results.get('impact_test', {}) %}
                                {% if impact_test %}
                                    <h4>Impact Test</h4>
                                    {% if impact_test is mapping %}
                                        {% if impact_test.specimens is defined and impact_test.specimens|length > 0 %}
                                            <table class="test-results-table">
                                                <thead>
                                                    <tr>
                                                        <th>Specimen</th>
                                                        <th>Location</th>
                                                        <th>Temperature</th>
                                                        <th>Energy</th>
                                                        <th>Result</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for specimen in impact_test.specimens %}
                                                        {% if specimen is mapping %}
                                                            <tr>
                                                                <td>{{ specimen.get('specimen_number', specimen.get('specimen_id', loop.index)) }}</td>
                                                                <td>{{ specimen.get('location', 'N/A') }}</td>
                                                                <td>{{ specimen.get('temperature', 'N/A') }}</td>
                                                                <td>{{ specimen.get('energy', 'N/A') }}</td>
                                                                <td>{{ specimen.get('result', 'N/A') }}</td>
                                                            </tr>
                                                        {% else %}
                                                            <tr>
                                                                <td colspan="5">{{ specimen }}</td>
                                                            </tr>
                                                        {% endif %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %}
                                            <table class="test-results-table">
                                                <tbody>
                                                    {% for key, value in impact_test.items() %}
                                                        <tr>
                                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                                            <td>{{ value }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    {% elif impact_test is string %}
                                        <p>{{ impact_test }}</p>
                                    {% endif %}
                                {% endif %}

                                <!-- Hardness Test Section -->
                                {% set hardness_test = pqr_data.test_results.get('hardness_test', {}) %}
                                {% if hardness_test %}
                                    <h4>Hardness Test</h4>
                                    {% if hardness_test is mapping %}
                                        {% if hardness_test.specimens is defined and hardness_test.specimens|length > 0 %}
                                            <table class="test-results-table">
                                                <thead>
                                                    <tr>
                                                        <th>Location</th>
                                                        <th>Value</th>
                                                        <th>Scale</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for specimen in hardness_test.specimens %}
                                                        {% if specimen is mapping %}
                                                            <tr>
                                                                <td>{{ specimen.get('location', 'N/A') }}</td>
                                                                <td>{{ specimen.get('value', 'N/A') }}</td>
                                                                <td>{{ specimen.get('scale', 'N/A') }}</td>
                                                            </tr>
                                                        {% else %}
                                                            <tr>
                                                                <td colspan="3">{{ specimen }}</td>
                                                            </tr>
                                                        {% endif %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %}
                                            <table class="test-results-table">
                                                <tbody>
                                                    {% for key, value in hardness_test.items() %}
                                                        <tr>
                                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                                            <td>{{ value }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endif %}
                                    {% elif hardness_test is string %}
                                        <p>{{ hardness_test }}</p>
                                    {% endif %}
                                {% endif %}

                                <!-- Additional Tests Section - Handle flat or nested structures -->
                                {% if pqr_data.test_results.get('additional_tests', None) %}
                                    {% set additional_tests = pqr_data.test_results.get('additional_tests', {}) %}
                                    <h4>Additional Tests</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if additional_tests is mapping %}
                                                {% for test_name, test_value in additional_tests.items() %}
                                                    <tr>
                                                        <th>{{ test_name|replace('_', ' ')|title }}</th>
                                                        <td>{{ test_value }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% elif additional_tests is string %}
                                                <tr>
                                                    <th>Additional Tests</th>
                                                    <td>{{ additional_tests }}</td>
                                                </tr>
                                            {% else %}
                                                <tr>
                                                    <th>Impact Test</th>
                                                    <td>{{ pqr_data.test_results.get('impact_test', 'Not specified') }}</td>
                                                </tr>
                                                <tr>
                                                    <th>Hardness Test</th>
                                                    <td>{{ pqr_data.test_results.get('hardness_test', 'Not specified') }}</td>
                                                </tr>
                                                <tr>
                                                    <th>Other Tests</th>
                                                    <td>{{ pqr_data.test_results.get('other_tests', 'Not specified') }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% endif %}

                                <!-- Testing Laboratory Information -->
                                {% if pqr_data.testing_laboratory is defined and pqr_data.testing_laboratory %}
                                    <h4>Testing Laboratory</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if pqr_data.testing_laboratory is mapping %}
                                                {% for key, value in pqr_data.testing_laboratory.items() %}
                                                    <tr>
                                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                                        <td>{{ value }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% elif pqr_data.testing_laboratory is string %}
                                                <tr>
                                                    <th>Laboratory</th>
                                                    <td>{{ pqr_data.testing_laboratory }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% elif pqr_data.test_lab is defined and pqr_data.test_lab %}
                                    <h4>Testing Laboratory</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if pqr_data.test_lab is mapping %}
                                                {% for key, value in pqr_data.test_lab.items() %}
                                                    <tr>
                                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                                        <td>{{ value }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% elif pqr_data.test_lab is string %}
                                                <tr>
                                                    <th>Laboratory</th>
                                                    <td>{{ pqr_data.test_lab }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% endif %}

                                <!-- Welder Information -->
                                {% if pqr_data.welder_information is defined and pqr_data.welder_information %}
                                    <h4>Welder Information</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if pqr_data.welder_information is mapping %}
                                                {% if pqr_data.welder_information.welders is defined and pqr_data.welder_information.welders is iterable %}
                                                    {% for welder in pqr_data.welder_information.welders %}
                                                        <tr>
                                                            <th>Welder {{ loop.index }}</th>
                                                            <td>{{ welder.get('name', 'N/A') }} ({{ welder.get('welder_no', 'N/A') }})</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    {% for key, value in pqr_data.welder_information.items() %}
                                                        <tr>
                                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                                            <td>{{ value }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% endif %}
                                            {% elif pqr_data.welder_information is string %}
                                                <tr>
                                                    <th>Welder Information</th>
                                                    <td>{{ pqr_data.welder_information }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% endif %}

                                <!-- Reference Standards -->
                                {% if pqr_data.reference_standards is defined and pqr_data.reference_standards %}
                                    <h4>Reference Standards</h4>
                                    {% if pqr_data.reference_standards is iterable and not pqr_data.reference_standards is string %}
                                        <ul class="reference-standards-list">
                                            {% for standard in pqr_data.reference_standards %}
                                                <li>{{ standard }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% elif pqr_data.reference_standards is string %}
                                        <p>{{ pqr_data.reference_standards }}</p>
                                    {% endif %}
                                {% endif %}

                                <!-- General Test Information -->
                                <h4>Test Information</h4>
                                <table class="test-results-table">
                                    <tbody>
                                        {% for key, value in pqr_data.test_results.items() %}
                                            {% if key not in ['tensile_test', 'guided_bend_test', 'additional_tests', 'impact_test', 'hardness_test', 'other_tests'] and value is not mapping and value is not iterable or value is string %}
                                                <tr>
                                                    <th>{{ key|replace('_', ' ')|title }}</th>
                                                    <td>{{ value }}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% elif pqr_data.test_results is string %}
                                <p>{{ pqr_data.test_results }}</p>
                            {% elif pqr_data.test_results is iterable and not pqr_data.test_results is string %}
                                <ul>
                                    {% for item in pqr_data.test_results %}
                                        {% if item is mapping %}
                                            <li>
                                                <strong>{{ item.get('name', 'Test') }}</strong>: 
                                                {{ item.get('result', item.get('value', 'No result specified')) }}
                                            </li>
                                        {% else %}
                                            <li>{{ item }}</li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}

                            <!-- Handle top-level test sections that might not be in test_results -->
                            {% for section_name in ['tensile_test', 'guided_bend_test', 'impact_test', 'hardness_test'] %}
                                {% if section_name in pqr_data and section_name not in pqr_data.test_results %}
                                    <h4>{{ section_name|replace('_', ' ')|title }}</h4>
                                    {% set test_section = pqr_data[section_name] %}
                                    {% if test_section is mapping and 'specimens' in test_section and test_section.specimens|length > 0 %}
                                        <table class="test-results-table">
                                            <thead>
                                                <tr>
                                                    {% for key in test_section.specimens[0].keys() %}
                                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for specimen in test_section.specimens %}
                                                    <tr>
                                                        {% for value in specimen.values() %}
                                                            <td>{{ value }}</td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% elif test_section is mapping %}
                                        <table class="test-results-table">
                                            <tbody>
                                                {% for key, value in test_section.items() %}
                                                    {% if key != 'specimens' %}
                                                        <tr>
                                                            <th>{{ key|replace('_', ' ')|title }}</th>
                                                            <td>{{ value }}</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% elif test_section is string %}
                                        <p>{{ test_section }}</p>
                                    {% else %}
                                        <pre>{{ test_section|string }}</pre>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}

                            <!-- Handle testing laboratory at top level if not in test_results -->
                            {% if not (pqr_data.testing_laboratory is defined and pqr_data.testing_laboratory) and not (pqr_data.test_lab is defined and pqr_data.test_lab) %}
                                {% if pqr_data.testing_laboratory is defined and pqr_data.testing_laboratory %}
                                    <h4>Testing Laboratory</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if pqr_data.testing_laboratory is mapping %}
                                                {% for key, value in pqr_data.testing_laboratory.items() %}
                                                    <tr>
                                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                                        <td>{{ value }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% elif pqr_data.testing_laboratory is string %}
                                                <tr>
                                                    <th>Laboratory</th>
                                                    <td>{{ pqr_data.testing_laboratory }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            {% endif %}

                            <!-- Handle welder information at top level -->
                            {% if not (pqr_data.welder_information is defined and pqr_data.welder_information) %}
                                {% if pqr_data.welder is defined and pqr_data.welder %}
                                    <h4>Welder Information</h4>
                                    <table class="test-results-table">
                                        <tbody>
                                            {% if pqr_data.welder is mapping %}
                                                {% for key, value in pqr_data.welder.items() %}
                                                    <tr>
                                                        <th>{{ key|replace('_', ' ')|title }}</th>
                                                        <td>{{ value }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% elif pqr_data.welder is string %}
                                                <tr>
                                                    <th>Welder</th>
                                                    <td>{{ pqr_data.welder }}</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                {% endif %}
                            {% endif %}

                            <!-- Handle reference standards at top level -->
                            {% if not (pqr_data.reference_standards is defined and pqr_data.reference_standards) %}
                                {% if pqr_data.standards is defined and pqr_data.standards %}
                                    <h4>Reference Standards</h4>
                                    {% if pqr_data.standards is iterable and not pqr_data.standards is string %}
                                        <ul class="reference-standards-list">
                                            {% for standard in pqr_data.standards %}
                                                <li>{{ standard }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% elif pqr_data.standards is string %}
                                        <p>{{ pqr_data.standards }}</p>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        </div>
                    {% else %}
                        <p>No test results data available</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 